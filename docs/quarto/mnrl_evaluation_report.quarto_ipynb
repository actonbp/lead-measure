{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"MNRL Model Evaluation Report\"\n",
        "author: \"Lead Measure Research Team\"\n",
        "date: today\n",
        "format:\n",
        "  pdf:\n",
        "    toc: true\n",
        "    number-sections: true\n",
        "    colorlinks: true\n",
        "---"
      ],
      "id": "d0712816"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "#| output: false\n",
        "\n",
        "import os\n",
        "import re\n",
        "import pandas as pd\n",
        "import matplotlib.pyplot as plt\n",
        "import matplotlib.image as mpimg\n",
        "from pathlib import Path\n",
        "\n",
        "# Find the latest evaluation directories\n",
        "ipip_dirs = list(Path(\"../../data/visualizations\").glob(\"mnrl_evaluation_*\"))\n",
        "leadership_dirs = list(Path(\"../../data/visualizations\").glob(\"leadership_mnrl_evaluation_*\"))\n",
        "\n",
        "# Sort by creation time (newest first)\n",
        "ipip_dirs.sort(key=lambda x: os.path.getctime(x), reverse=True)\n",
        "leadership_dirs.sort(key=lambda x: os.path.getctime(x), reverse=True)\n",
        "\n",
        "ipip_dir = ipip_dirs[0] if ipip_dirs else None\n",
        "leadership_dir = leadership_dirs[0] if leadership_dirs else None\n",
        "\n",
        "# Extract metrics\n",
        "def extract_metrics(metrics_file):\n",
        "    metrics = {}\n",
        "    with open(metrics_file, 'r') as f:\n",
        "        content = f.read()\n",
        "        \n",
        "        # Extract model name\n",
        "        model_match = re.search(r\"Model: ([^\\n]+)\", content)\n",
        "        if model_match:\n",
        "            metrics['model'] = model_match.group(1)\n",
        "        \n",
        "        # Extract ARI\n",
        "        ari_match = re.search(r\"Adjusted Rand Index: ([0-9.]+)\", content)\n",
        "        if ari_match:\n",
        "            metrics['ari'] = float(ari_match.group(1))\n",
        "        \n",
        "        # Extract NMI\n",
        "        nmi_match = re.search(r\"Normalized Mutual Information: ([0-9.]+)\", content)\n",
        "        if nmi_match:\n",
        "            metrics['nmi'] = float(nmi_match.group(1))\n",
        "        \n",
        "        # Extract Purity\n",
        "        purity_match = re.search(r\"Cluster Purity: ([0-9.]+)\", content)\n",
        "        if purity_match:\n",
        "            metrics['purity'] = float(purity_match.group(1))\n",
        "    \n",
        "    return metrics\n",
        "\n",
        "ipip_metrics = extract_metrics(ipip_dir / \"evaluation_metrics.txt\")\n",
        "leadership_metrics = extract_metrics(leadership_dir / \"leadership_metrics.txt\")\n",
        "\n",
        "# Parse leadership similarity data\n",
        "def parse_leadership_similarity(metrics_file):\n",
        "    similar_pairs = []\n",
        "    with open(metrics_file, 'r') as f:\n",
        "        content = f.read()\n",
        "        \n",
        "        # Try to find the similarity section\n",
        "        if \"Highly Similar Construct Pairs\" in content:\n",
        "            sim_section = content.split(\"Highly Similar Construct Pairs\")[1].split(\"Generated on\")[0]\n",
        "            pair_matches = re.findall(r\"  - ([^:]+): ([0-9.]+)\", sim_section)\n",
        "            for match in pair_matches:\n",
        "                constructs, similarity = match\n",
        "                similar_pairs.append({\n",
        "                    'constructs': constructs.strip(),\n",
        "                    'similarity': float(similarity)\n",
        "                })\n",
        "    \n",
        "    return similar_pairs\n",
        "\n",
        "leadership_similar_pairs = parse_leadership_similarity(leadership_dir / \"leadership_metrics.txt\")"
      ],
      "id": "d7f10048",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Executive Summary\n",
        "\n",
        "This report presents the evaluation results of our IPIP MNRL (Multiple Negatives Ranking Loss) model trained on comprehensive personality item pairs. We assess how effectively the model clusters both personality items and leadership items by their respective construct categories.\n",
        "\n",
        "### Key Findings\n",
        "\n",
        "**IPIP Personality Data**:\n",
        "\n",
        "- **Adjusted Rand Index (ARI)**: `{python} f\"{ipip_metrics.get('ari', 0):.4f}\"`\n",
        "- **Normalized Mutual Information (NMI)**: `{python} f\"{ipip_metrics.get('nmi', 0):.4f}\"`\n",
        "- **Cluster Purity**: `{python} f\"{ipip_metrics.get('purity', 0):.4f}\"`\n",
        "\n",
        "**Leadership Construct Data**:\n",
        "\n",
        "- **Adjusted Rand Index (ARI)**: `{python} f\"{leadership_metrics.get('ari', 0):.4f}\"`\n",
        "- **Normalized Mutual Information (NMI)**: `{python} f\"{leadership_metrics.get('nmi', 0):.4f}\"`\n",
        "- **Cluster Purity**: `{python} f\"{leadership_metrics.get('purity', 0):.4f}\"`\n",
        "\n",
        "The substantial drop in metrics from IPIP to leadership data supports our research hypothesis that leadership constructs have significant overlap and are less distinctly separated than personality constructs.\n",
        "\n",
        "## IPIP Personality Constructs Evaluation\n",
        "\n",
        "The model shows moderate performance in clustering personality items by their construct categories, significantly above random assignment. This indicates the model successfully captures semantic relationships between items within the same personality construct.\n",
        "\n",
        "### IPIP Clustering Visualizations\n",
        "\n",
        "#### Confusion Matrix\n",
        "\n",
        "![IPIP Confusion Matrix](../../`{python} str(ipip_dir.relative_to(Path(\"../../\")))` + \"/confusion_matrix.png\")\n",
        "\n",
        "#### t-SNE Visualization (True Labels)\n",
        "\n",
        "![IPIP t-SNE True Labels](../../`{python} str(ipip_dir.relative_to(Path(\"../../\")))` + \"/tsne_true_labels.png\")\n",
        "\n",
        "#### t-SNE Visualization (Predicted Clusters)\n",
        "\n",
        "![IPIP t-SNE Predicted Clusters](../../`{python} str(ipip_dir.relative_to(Path(\"../../\")))` + \"/tsne_predicted_clusters.png\")\n"
      ],
      "id": "39f11240"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "#| output: false\n",
        "combined_exists = (ipip_dir / \"tsne_combined.png\").exists()"
      ],
      "id": "2a753bd4",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "if (ipip_dir / \"tsne_combined.png\").exists():\n",
        "    print(\"#### Combined t-SNE Visualization\")\n",
        "    print(\"\")\n",
        "    print(f\"![IPIP t-SNE Combined](../../{str(ipip_dir.relative_to(Path('../../')))}/tsne_combined.png)\")"
      ],
      "id": "23c1e103",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Leadership Constructs Evaluation\n",
        "\n",
        "The model shows much lower performance on leadership data, with clustering metrics significantly below those for personality constructs. This suggests that leadership constructs, as currently measured, do not form semantically distinct categories.\n",
        "\n",
        "### Leadership Clustering Visualizations\n",
        "\n",
        "#### Leadership Confusion Matrix\n",
        "\n",
        "![Leadership Confusion Matrix](../../`{python} str(leadership_dir.relative_to(Path(\"../../\")))` + \"/leadership_confusion_matrix.png\")\n",
        "\n",
        "#### Leadership t-SNE Visualization (True Labels)\n",
        "\n",
        "![Leadership t-SNE True Labels](../../`{python} str(leadership_dir.relative_to(Path(\"../../\")))` + \"/leadership_tsne_true_labels.png\")\n",
        "\n",
        "#### Leadership t-SNE Visualization (Predicted Clusters)\n",
        "\n",
        "![Leadership t-SNE Predicted Clusters](../../`{python} str(leadership_dir.relative_to(Path(\"../../\")))` + \"/leadership_tsne_predicted_clusters.png\")\n",
        "\n",
        "#### Leadership Construct Similarity\n",
        "\n",
        "![Leadership Construct Similarity](../../`{python} str(leadership_dir.relative_to(Path(\"../../\")))` + \"/leadership_construct_similarity.png\")\n",
        "\n",
        "### Leadership Construct Overlap Analysis\n",
        "\n",
        "The analysis reveals substantial overlap between leadership constructs. Below are the most similar construct pairs (similarity > 0.85):\n"
      ],
      "id": "a8d884b7"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "# Sort by similarity\n",
        "leadership_similar_pairs.sort(key=lambda x: x['similarity'], reverse=True)\n",
        "\n",
        "# Display as a table\n",
        "top_pairs = [pair for pair in leadership_similar_pairs if pair['similarity'] > 0.85]\n",
        "if top_pairs:\n",
        "    df = pd.DataFrame(top_pairs)\n",
        "    df.columns = [\"Construct Pair\", \"Similarity\"]\n",
        "    display(df)\n",
        "else:\n",
        "    print(\"No construct pairs with similarity > 0.85 found.\")"
      ],
      "id": "b558ea64",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "## Conclusion\n",
        "\n",
        "The results strongly support our research hypothesis that leadership constructs, as currently measured in the literature, have substantial semantic overlap and are less distinctly separated than personality constructs. Many leadership construct pairs show similarity values above 0.85, indicating they may be measuring essentially the same underlying concept despite having different names.\n",
        "\n",
        "This suggests that the current taxonomic structure of leadership measurement may be artificially complex, with many constructs capturing similar underlying concepts. Future research should focus on identifying a more parsimonious set of truly distinct leadership dimensions.\n",
        "\n",
        "## Appendix: Model and Evaluation Details\n",
        "\n",
        "- **Model**: MNRL (Multiple Negatives Ranking Loss) with `all-mpnet-base-v2` base model\n",
        "- **Training Data**: Comprehensive and balanced anchor-positive IPIP item pairs\n",
        "- **IPIP Evaluation**: Test set with items across personality constructs\n",
        "- **Leadership Evaluation**: Leadership items across 11 leadership constructs"
      ],
      "id": "1d9ca16e"
    }
  ],
  "metadata": {
    "kernelspec": {
      "display_name": "Python 3",
      "language": "python",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}